
# TAGGING FRAMEWORK SOURCE CODE

This is the actual React hook implementation from: `src/pages/ExpressStore/Tagging/index.js`

**READ THIS CODE CAREFULLY** - This is the source of truth.
Understand:
1. What functions are exported
2. What parameters each function accepts
3. How each function is called
4. What each function returns

```javascript
import { store } from 'onevzsoemfeframework/Storemfe';
import basicDlObject from './dlStructure';
import { getPaymentTypeLabel } from '../util/getBillPayment';

// Custom hook for tagging
const useTagging = () => {
  // Use useRef to persist data across renders without causing reloads
  // Helper to build defaultDL only when needed
  const buildDefaultDL = (type = '', flow = '', isFlowNameUpdate = false) => {
    const state = store.getState();
    const peripheralsInfo = state?.peripheralsInfo?.appInitVars || {};
    const userInfo = state?.billPay?.userData || {};
    const scanInfo = state?.scan?.repLoginData?.data || {};
    const commonDetails = state?.common || {};
    const billType = state?.billPay?.billType || '';
    const prepaidData = state?.billPay?.prePaidData || {};
    const billData = state?.billPay?.billSummary || {};
    const adaptiveData = state.common?.adaptiveLoginData;
    const paymentData = commonDetails?.paymentData || {};

    const defaultDL =
      typeof structuredClone === 'function'
        ? structuredClone(basicDlObject)
        : JSON.parse(JSON.stringify(basicDlObject));

    // Helper functions for each section
    const setUserInfo = () => {
      if (!userInfo?.mtn && !userInfo?.isFiosFlow) return;
      const accountParts = userInfo?.accountNumber?.split('-') || [];
      defaultDL.user.accountLast2 = accountParts[0]?.slice(-2) || '';
      defaultDL.user.acctId_unhashed = userInfo.accountNumber || '';

      if (userInfo?.isFiosFlow) {
        defaultDL.user.accountType = userInfo?.prepayAccount ? 'Prepay' : 'Postpay';
        defaultDL.user.authType = 'logged in';
        defaultDL.user.custId_unhashed = '';
      } else {
        defaultDL.user.accountType = userInfo?.accountType ?? '';
        defaultDL.user.custId_unhashed = accountParts[0] || '';
        defaultDL.user.id = billData?.mtnHashCode || '';
        defaultDL.user.account = billData?.accountHashCode || '';
      }

      if (userInfo?.verifiedBy) {
        defaultDL.user.authStatus = userInfo.verifiedBy === 'BLINDPAY' ? 'anonymous' : 'logged in';
        if (userInfo.verifiedBy === 'MY_VERIZON') {
          defaultDL.user.authType = adaptiveData?.listOfDevices?.[0]?.deviceType === 'BASIC' ? 'sms' : 'push';
        } else if (userInfo.verifiedBy === 'ACCOUNT_PIN') {
          defaultDL.user.authType = 'pin';
        }
      }
    };

    const setScanInfo = () => {
      if (!Object.keys(scanInfo).length) return;
      defaultDL.txn.agent = scanInfo.salesRepId ?? '';
      defaultDL.txn.agentRole = scanInfo.details?.jobTitledId ?? '';
    };

    const setCustomerInfo = () => {
      if (!Object.keys(userInfo).length) return;
      defaultDL.user.customerType = userInfo.customerType ?? '';
      defaultDL.user.customerRole = userInfo.amRole ?? '';
    };

    const setPrepaidInfo = () => {
      if (!Object.keys(prepaidData).length) return;
      defaultDL.user.id = prepaidData.hashed_mdn ?? '';
    };

    const setPaymentInfo = () => {
      if (!Object.keys(paymentData).length) return;
      if (paymentData.orderTotal) {
        defaultDL.txn.paymentAmt = Number(paymentData.orderTotal);
        defaultDL.txn.total = paymentData.orderTotal;
        defaultDL.txn.taxAmt = prepaidData?.taxInfo?.total_fee_amount ?? '';
      }
      if (paymentData?.paymentType) {
        defaultDL.txn.paymentType = getPaymentTypeLabel(paymentData.paymentType);
      }
      if (billType) {
        defaultDL.env.businessUnit = billType === 'mobile' ? 'Wireless' : 'Wireline';
      }
      defaultDL.txn.id =
        paymentData?.order_number ||
        paymentData?.orderNumber ||
        paymentData?.orderNum ||
        paymentData?.responseDetail?.pmtConfirmationNumber ||
        paymentData?.orders?.[0]?.orderNum ||
        defaultDL.txn.id;
    };

    const setPageLoadInfo = () => {
      if (type !== 'trackPageLoad') return;
      const machineType = peripheralsInfo.isPaypodEnabled ? 'paypod' : 'kiosk';
      const machineName = peripheralsInfo.machineName ?? '';
      const registerNumber = peripheralsInfo.registerNumber ?? '';
      defaultDL.page.formData = `bpkMachReg^|t:${machineType}|m:${machineName}|r:${registerNumber} |`;
    };

    const setFlowName = () => {
      if (type !== 'trackPageLoad' || !isFlowNameUpdate) return;
      const isFiosFlow = !!userInfo?.isFiosFlow;
      const menu = commonDetails?.menuSelected;
      if (menu === 'payBill') {
        defaultDL.page.flow = `${isFiosFlow ? 'pay bill home internet' : 'pay bill mobile'}-${flow}`;
      } else if (menu === 'completeOrder') {
        defaultDL.page.flow = `Complete order-${flow}`;
      } else {
        defaultDL.page.flow = `Scan And Go-${flow}`;
      }
    };

    // Call helpers
    setUserInfo();
    setScanInfo();
    setCustomerInfo();
    setPrepaidInfo();
    setPaymentInfo();
    setPageLoadInfo();
    setFlowName();

    // Set outletId always
    defaultDL.txn.outletId = peripheralsInfo.locationCode ?? '';
    defaultDL.page.channelSession = localStorage.getItem('bpkUUID') ?? '';

    return defaultDL;
  };

  const trackPageLoad = ({ pageName = '', flow = '', subFlow = '', event = '', isFlowNameUpdate = false } = {}) => {
    try {
      const model = buildDefaultDL('trackPageLoad', flow, isFlowNameUpdate);
      model.page.name = pageName;
      if (!isFlowNameUpdate) {
        model.page.flow = flow;
      }
      model.page.subFlow = subFlow;
      model.event.value = event;
      window.vzdl = model;
      window.coreData = window.coreData ?? [];
      window.coreData.push({
        task: 'emit',
        event: 'pageView',
      });
    } catch (e) {
      console.error('Error in site catalyst ', e);
    }
  };

  const trackPageNotification = (name = '', message = '', id = '') => {
    try {
      const data = buildDefaultDL();
      window.vzdl = data;
      window.coreData = window.coreData ?? [];
      window.coreData.push({
        task: 'emit',
        event: 'notify',
        params: {
          name,
          message,
          error: true,
          id,
        },
      });
    } catch (e) {
      console.log('Error in site catalyst', e);
    }
  };

  const trackPageChange = (selectorIdOrClass = '', message = '') => {
    try {
      const data = buildDefaultDL();
      window.vzdl = data;
      window.coreData.push({
        task: 'emit',
        event: 'openView',
        params: {
          selector: selectorIdOrClass,
          message,
        },
      });
    } catch (e) {
      console.log('Error in site catalyst', e);
    }
  };

  return { trackPageLoad, trackPageNotification, trackPageChange };
};

export { useTagging };

```

---

## YOUR TASK

You will read the framework code above and:
1. Understand what functions are available
2. Understand what parameters each function expects
3. Understand how to import and use useTagging
4. Apply this understanding to the target file below


---

## TARGET FILE (the file you need to modify)

**Path**: `src\pages\ExpressStore\PayBill\PayBillType\index.js`

```javascript
import React, { useEffect } from 'react';
import PropTypes from 'prop-types';
import { usePeripheralNavigate } from '../../utils';
import CardBill from '../../Common/CardBill';


function PayBillType({ handlePaymentSelection }) {
  const navigate = usePeripheralNavigate();



  return (
    <CardBill
      data-testid='payBill-testId'
      {...{
        onBack: () => {
          navigate('/home');
        },
        isBackButton: true,
        isMenu: true,
        title: 'What type of bill do you want to pay?',
        tileList: [
          { title: 'Mobile', subtitle: '', icon: '', handleClick: () => handlePaymentSelection('mobile') },
          { title: 'Home Internet', subtitle: '', icon: '', handleClick: () => handlePaymentSelection('homeInternet') },
        ],
      }}
    />
  );
}

PayBillType.propTypes = {
  handlePaymentSelection: PropTypes.func,
};

export default PayBillType;

```

---

## TASK REQUIREMENTS

**What to add**:
- Description: 
- Action Type: page_load
- Function to call: trackPageLoad
- Parameters needed: {
  "pageName": "Bill type",
  "flow": "BPK Bill type",
  "subFlow": "Bill Type Options",
  "event": "BillType_Page_Load"
}
- Anchor Line: 1

---

## INSTRUCTIONS

You are a code transformation assistant. Your job:

1. **READ and ANALYZE the Tagging framework code** (at the top of this prompt)
   - Read the full source code carefully
   - Understand what functions are exported
   - Understand what parameters each function accepts
   - See how useTagging is called
   - DO NOT invent functions

2. **IDENTIFY the function you need to call**: trackPageLoad
   - Read the framework code to find this function
   - Understand its parameters by reading the function definition
   - These parameters are REQUIRED - you MUST use them

3. **READ the target file** (current React component below)
   - Check if this function is already imported
   - Check if this function is already being called
   - If already present â†’ return UNCHANGED with reason

4. **ADD imports IF MISSING**:
   - Read the framework: how is useTagging imported/exported?
   - Calculate correct relative path based on target file location
   - Add import statement at top if not present
   - useTagging is self-contained - NO other dependencies needed

5. **ADD hook call IF MISSING**:
   - Read the framework: how does useTagging() work?
   - Call it like any React hook and destructure what you need
   - Example: `const { trackPageLoad } = useTagging();`
   - Place after other hook declarations
   - NO special setup or initialization needed

6. **ADD tracking call with EXACT parameters**:
   - Read the framework code for trackPageLoad function
   - Use EXACTLY the parameters from "Parameters needed" below
   - Read how the function should be called from framework
   - Determine best place to call (handler, useEffect, catch block, etc.)
   
   **IMPORTANT - useEffect handling for trackPageLoad**:
   - If trackPageLoad is trackPageLoad: ALWAYS use empty dependency array []
   - Empty dependency array [] means: runs ONLY ONCE on component mount
   - CORRECT: useEffect(() => { trackPageLoad(...) }, [])
   - WRONG: useEffect(() => { trackPageLoad(...) }) without []
   - WRONG: useEffect(() => { trackPageLoad(...) }, [deps])
   - The empty [] is REQUIRED for proper page load tracking behavior

7. **PRESERVE all other code**:
   - Don't modify unrelated parts
   - Don't change formatting or variable names
   - Only add what's needed for this task

8. **Return JSON result**:
   ```json
   {
     "applied": true/false,
     "reason": "explanation",
     "updated_file": "full file content here or unchanged content"
   }
   ```

---

## PARAMETER MAPPING

The parameters you MUST use for this task:


- `pageName`: Bill type
- `flow`: BPK Bill type
- `subFlow`: Bill Type Options
- `event`: BillType_Page_Load

These are the EXACT parameters that must be passed to trackPageLoad.
Use ONLY these values - do NOT invent or make up values.

---

## KEY RULES

- **Framework is source of truth** - read and understand the actual code
- **Match parameters exactly** - use ONLY what's in the framework
- **NO inventing** - don't create functions or parameters that don't exist
- **Preserve existing code** - don't modify unrelated parts
- **Idempotent** - if already applied, return unchanged
- **Correct paths** - calculate relative import paths based on file location
